#!/usr/bin/env node

//
// TTN Bot
//

var ConsoleLogger = require('kadoh/lib/logger/reporter/color-console')
var logging = require('kadoh/lib/logging');

process.listening = true;

var argv  = require('optimist')
            .usage('Usage: $0 -b 127.0.0.1:3001 -l debug --cli -p 10000')
            .alias('b', 'bootstraps')
            .describe('b', 'comma separated list of bootstraps')
            .alias('l', 'log')
            .describe('l', 'log level (debug, info, warn, error, fatal)')
            .alias('p', 'port')
            .describe('p', 'port')
            .alias('i', 'id')
            .describe('i', 'id to assign the node, otherwise one is generated')
            .alias('h', 'help')
            .describe('h', 'help')
            .alias('d', 'data')
            .describe('d', 'path where data is stored.')
            .alias('n', 'name')
            .describe('n', 'bot name')
            .argv;

if (argv.h){
  console.log(require('optimist').help());
  return
}

var config = {
  "nodeName":argv.n || "Bot1",
  "dht": {
    "bootstraps" : [argv.b||'127.0.0.1:3001'],
    "port": parseInt(argv.port, 10) || 10000,
  },
  "RESTServer" : {
    "port": parseInt(argv.port, 10) || 10000,
  },
  "startup" : {
    "joinDHT" : "true",
    "startRESTServer" : "true"
  },
  "dataPath": argv.d
};

new ConsoleLogger(logging, argv.l||'info');

var TTNNode = require("../js/ttn-node");

var bot = new TTNNode(config);
